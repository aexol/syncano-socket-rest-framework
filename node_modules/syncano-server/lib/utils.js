'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

exports.checkStatus = checkStatus;
exports.parseJSON = parseJSON;
exports.buildSyncanoURL = buildSyncanoURL;
exports.buildInstanceURL = buildInstanceURL;

var _settings = require('./settings');

function checkStatus(response) {
  if (response.status >= 200 && response.status < 300) {
    return response.data;
  }

  var error = void 0;

  try {
    error = new Error(response.data.detail);
  } catch (err) {
    error = new Error(response.statusText);
  }

  error.response = response;
  error.data = response.data;
  error.status = response.status;
  error.headers = response.headers;
  error.size = response.size;
  error.timeout = response.timeout;
  error.url = response.url;

  throw error;
}

function parseJSON(response) {
  var mimetype = response.headers.get('Content-Type');

  if (response.status === 204 || mimetype === null) {
    return Promise.resolve(_extends({
      data: undefined
    }, response));
  }

  // Parse JSON
  if (/^.*\/.*\+json/.test(mimetype) || /^application\/json/.test(mimetype)) {
    return response.json().then(function (res) {
      return _extends({
        data: res
      }, response);
    });
  }

  // Parse XML and plain text
  if (/^text\/.*/.test(mimetype) || /^.*\/.*\+xml/.test(mimetype) || mimetype === 'text/plain') {
    return response.text().then(function (res) {
      return _extends({
        data: res
      }, response);
    });
  }

  return response.arraybuffer();
}

function buildSyncanoURL() {
  return 'https://' + (0, _settings.getHost)() + '/' + _settings.SYNCANO_API_VERSION;
}

function buildInstanceURL(instanceName) {
  return buildSyncanoURL() + '/instances/' + instanceName;
}